{% extends "base.html" %}
{% load static %}

{% block extra_title %}- FAQs{% endblock %}

{% block extra_meta %}
    <meta name="description" content="Want to know more about Posh Portables? Check out our Frequently Asked Questions.">
{% endblock %}

{% block content %}

<div class="container-fluid header-container">
    
    <!-- Title Section -->
    <div class="row">
        <div class="col-12 col-md-6">
            <h1 class="mb-3">FAQs</h1>
            <p class="mb-3">All you need to know about delivery, returns, refunds and general info. Click on a question to reveal the answer.</p>
            
            {% if request.user.is_superuser %}
                <!-- Add FAQ button -->
                <a href="{% url 'create_faq' %}" class="logo-font bg-black">Create FAQ</a>
            {% endif %}
            <hr>
        </div>
    </div>

    <!-- FAQs Container -->
    <div class="row">
        <div class="col-12 col-md-6">
            {% for faq in faqs %}
                <div class="card w-100 border-0 border-bottom rounded-0 pb-3 mb-3">
                    <div class="card-header border-0 p-0 d-flex justify-content-between" id="header-{{ faq.id }}">

                        <!-- FAQ Question & Collapse Trigger -->
                        <p class="{% if request.user.is_superuser %}me-3{% endif %}">
                            <button class="bg-black" type="button" data-toggle="collapse" data-target="#collapse-{{faq.id}}" aria-expanded="false" aria-controls="collapse-{{faq.id}}">
                                {{faq.question}}
                            </button>
                        </p>
                        
                        {% if request.user.is_superuser %}
                            <!-- FAQ EDIT / DELETE Buttons -->
                            <div class="edit-del-faq-wrapper">
                                <a href="{% url 'update_faq' faq.id %}" class="shop-now-button btn rounded text-uppercase py-3">Update FAQ</a>
                                <button type="button" data-toggle="modal" data-target="#modal-{{ faq.id }}" class="btn btn-danger">Delete FAQ</button>
                            </div>

                            <!-- Confirm Delete Modal - Defensive Programming -->
                            <div class="modal fade" id="modal-{{ faq.id }}" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header py-3">
                                            <h2 class="logo-font">DELETE FAQ</h2>
                                            <button type="button" class="close modal-close-cross" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="pb-2">
                                            <p>Are you sure you want to the delete the FAQ entry for...
                                            <strong>"{{ faq.question }}"</strong></p>
                                        </div>
                                        <div class="modal-footer pt-0">
                                            <button type="button" class="btn btn-info" data-dismiss="modal">CLOSE</button>
                                            <a href="{% url 'remove_faq' faq.id %}" class="btn btn-danger">DELETE</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                
                    <!-- FAQ Answer Collapsible -->
                    <div id="collapse-{{faq.id}}" class="collapse" aria-labelledby="header-{{ faq.id }}" data-parent="#faq-accordion">
                        <div class="card-body px-0 pt-3 pb-0">
                            <p>{{faq.answer}}</p>                    
                        </div>
                    </div>

                </div>
            {% endfor %}
        </div> 
    </div>
</div>
{% endblock %}